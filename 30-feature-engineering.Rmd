---
title: "30-feature-engineering"
output: html_notebook
---


# 4. Using best practices, write four functions which add engineered features to the dataset, including a description and rationale. Include a test to determine whether the features are working as intended. 


## 4.1 Adding Feature: Level of time spend in company

The level of time spend in company may have impact on employee's leave. Therefore, I add this new feature which dividing the time spend in company into 3 levels: low, medium, high.
```{r_time_spend_company_level}
time_spend_company_level <- function(df) {
  if (! "time_spend_company" %in% names(df)) {
    stop("`data` must containing `time_spend_company`")
  }
  df %>% 
    mutate(time_spend_company_level = case_when(
      time_spend_company <= 4 ~ "low",
      time_spend_company <= 7 ~"medium",
      TRUE ~ "high"
    ))
}
```

```{r check_time_spend_company_level}
df %>% 
  time_spend_company_level() %>% 
  assert(in_set(c("low", "medium", "high")), time_spend_company_level)
```
The test above shows time_spend_company_level only contains low, medium, high, this new feature is working.


## 4.2 Adding Feature: Level of time spend in company

The level of average monthly hours may have impact on employee's leave. Therefore, I add this new feature which dividing the average monthly hours into 3 levels: low, medium, high.
```{r_average_monthly_hours_level}
average_monthly_hours_level <- function(df) {
  if (! "average_monthly_hours" %in% names(df)) {
    stop("`data` must containing `average_monthly_hours`")
  }
  df %>% 
    mutate(average_monthly_hours_level = case_when(
      average_monthly_hours <= 167 ~ "low",
      average_monthly_hours <= 238 ~"medium",
      TRUE ~ "high"
    ))
}
```

```{r check_average_monthly_hours_level}
df %>% 
  average_monthly_hours_level() %>% 
  assert(in_set(c("low", "medium", "high")), average_monthly_hours_level)
```
The test above shows average_monthly_hours_level only contains low, medium, high, this new feature is working.


## 4.3 Adding Feature: Satisfaction level over average

The satisfaction level over average may have impact on employee's leave. Therefore, I add this new feature which calculating the difference between sarisfaction level and overal average satisfaction level.
```{r satisfaction_level_over_avg}
satisfaction_level_over_avg <- function(df) {
  if (! "satisfaction_level" %in% names(df)) {
    stop("`data` must containing `satisfaction_level`")
  }
  df %>% 
    mutate(satisfaction_level_over_avg = satisfaction_level - mean(satisfaction_level))
}
```

```{r check_satisfaction_level_over_avg}
df %>% 
  satisfaction_level_over_avg() %>% 
  assert(within_bounds(-1, 1), satisfaction_level_over_avg)
```
The test above shows satisfaction_level_over_avg is within the bounds of -1 and 1, this new feature is working.


## 4.4 Adding Feature: Last evaluation over average

The last evaluation over average may have impact on employee's leave. Therefore, I add this new feature which calculating the difference between last evaluation and overal average last evaluation.

```{r_last_evaluation_over_avg}
last_evaluation_over_avg <- function(df) {
  if (! "last_evaluation" %in% names(df)) {
    stop("`data` must containing `last_evaluation`")
  }
  df %>% 
    mutate(last_evaluation_over_avg = last_evaluation - mean(last_evaluation))
}
```

```{r check_last_evaluation_over_avg}
df %>% 
  last_evaluation_over_avg() %>% 
  assert(within_bounds(-1, 1), last_evaluation_over_avg)
```
The test above shows last_evaluation_over_avg is within the bounds of -1 and 1, this new feature is working.


# 5. Prepare the data for modeling

A new data frame with four new engineering feature is generated by applying the four fuctions created above.

```{r prepare_for_modeling}
df <- df %>% 
  average_monthly_hours_level() %>% 
  time_spend_company_level() %>% 
  satisfaction_level_over_avg() %>%
  last_evaluation_over_avg()

head(df)
```

The head shows the new features is working as intended. This new data frame is ready for modeling in following steps. 


